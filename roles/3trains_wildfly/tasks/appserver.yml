---
- set_fact:
    instance_id: "{{ item }}"

- name: "Set up for Wildfly instance {{ instance_id }}"
  include_role:
    name: wildfly_systemd
  vars:
    wildfly_home: "{{ wildfly.home }}"
    wildfly_user: "{{ wildfly.user }}"
    wildfly_group: "{{ wildfly.group }}"
    wildfly_config_base: "{{ wildfly.config.base }}"
    wildfly_basedir_prefix: "/var/run/{{ inventory_hostname }}"
    wildfly_config_name: "{{ inventory_hostname }}"
    wildfly_port_range_offset: -1
    wildfly_instance_name: "{{ inventory_hostname }}"
    instance_id: "{{ item }}"

- name: "Install Keycloak Extension on instance {{ instance_name }}"
  include_tasks: keycloak/keycloak-extension-install.yml
  when:
    - not enable_rhsso

- name: "Install RHSSO Extension on instance {{ instance_name }}"
  include_tasks: keycloak/keycloak-extension-install.yml
  when:
    - enable_rhsso

- name: "Deploy app on instance {{ instance_name }}"
  include_tasks: fine-tuned-wildfly.yml
